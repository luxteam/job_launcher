{% extends "base_template.html"%}

{% block report_body %}

<h1>details</h1>

{%- if i != "_cur_" %}
<h3>{{ i }}</h3>
{% endif -%}

{% include "images_compare_block.html" %}

<div class="jsTableWrapper">
    <div id="toolbar">
        <button class="commonButton" type="button" name="showOnlyPassedCases" onclick="searchTextInBootstrapTable('passed');">Show passed [{{ report[i].summary.passed }}]</button>
        <button class="commonButton" type="button" name="showOnlyFailedCases" onclick="searchTextInBootstrapTable('failed');">
            Show failed [{{ report[i].summary.failed }}]
            <span class="glyphicon glyphicon-question-sign" aria-haspopup="true" aria-hidden="true"data-toggle="tooltip" data-placement="top"
                  title="[Failed] status means that pixel difference with baseline image is too large."></span>
        </button>
        <button class="commonButton" type="button" name="showOnlyErrorCases" onclick="searchTextInBootstrapTable('error');">
            Show error [{{ report[i].summary.error }}]
            <span class="glyphicon glyphicon-question-sign" aria-haspopup="true" aria-hidden="true"data-toggle="tooltip" data-placement="top"
                  title="[Error] status means fatal error during render, terminating by timeout, or case wasn't launched at all."></span>
        </button>
        <button class="commonButton" type="button" name="showOnlySkippedCases" onclick="searchTextInBootstrapTable('skipped');">Show skipped [{{ report[i].summary.skipped }}]</button>
        <button class="commonButton" type="button" name="showAll" onclick="searchTextInBootstrapTable('');">Reset</button>
    </div>

    <table id="{{ i | lower | replace(' ', '_') | replace('(', '') | replace(')', '') }}"
           data-toolbar="#toolbar"
           class="baseTable detailedTable"
           data-toggle="table"
           data-search="true"
           data-show-refresh="true"
           data-show-toggle="false"
           data-show-columns="true"
           data-show-pagination-switch="true"
           data-pagination="true"
           data-page-size="10"
           data-page-list="[1, 5, 10, 20, 45, ALL]"
           data-sort-order="asc"
           data-sort-name="test_status"
           data-show-multi-sort="true"
    >
        <thead>
            <tr>
                <th data-field="test_case" data-visible="false" data-halign="center" data-valign="middle" data-sortable="true">Test case</th>
                <th data-field="test_case_copy" data-halign="center" data-valign="middle" data-sortable="true" data-events="copyTestCaseName">
                    Test case
                    <span class="glyphicon glyphicon-question-sign" aria-haspopup="true" aria-hidden="true"data-toggle="tooltip" data-placement="top" title="Button click copy direct test case link to clipboard"></span>
                </th>
                <th data-field="script_info" data-visible="{{ or_boolean_formatted_invert }}" data-halign="center" data-valign="middle" data-sortable="true">Params</th>

                <th data-field="original_img" data-visible="{{ or_boolean_formatted }}" data-halign="center" data-valign="middle" data-sortable="true" data-events="openFullImgSize" data-formatter="metaAJAX">{{ original_render | title }}</th>
                <th data-field="baseline_img" data-halign="center" data-valign="middle" data-sortable="true" data-events="openFullImgSize" data-formatter="metaAJAX">Baseline Color</th>
                <th data-field="rendered_img" data-halign="center" data-valign="middle" data-sortable="true" data-events="openFullImgSize" data-formatter="metaAJAX">Rendered color</th>

                <th data-field="test_status" data-halign="center" data-valign="middle" data-sortable="true">Test status
                    <span class="glyphicon glyphicon-question-sign" aria-haspopup="true" aria-hidden="true"data-toggle="tooltip" data-placement="top" title="[Failed] status means that pixel difference with baseline image is too large.
[Error] status means fatal error during render, terminating by timeout, or case wasn't launched at all.
[Skipped] status means case wasn't launched by QA team decision."></span>
                </th>
                <th data-field="pix_diff_2" data-halign="center" data-valign="middle" data-sortable="true">
                    Diff new
                    <span class="glyphicon glyphicon-question-sign" aria-haspopup="true" aria-hidden="true"data-toggle="tooltip" data-placement="top" title="[1] - diff images.
[0] - equals images.
[-1] - images has diff resolution, so couldn't be compared."></span>
                </th>

                <th data-field="original_time" data-visible="{{ or_boolean_formatted }}" data-halign="center" data-valign="middle" data-sortable="true" data-formatter="timeFormatter">{{ original_render | title }} render time</th>
                <th data-field="baseline_render_time" data-halign="center" data-valign="middle" data-sortable="true" data-formatter="timeFormatter">Baseline render time</th>
                <th data-field="render_time" data-halign="center" data-valign="middle" data-sortable="true" data-formatter="timeFormatter">Render time</th>
                <th data-field="time_diff" data-halign="center" data-valign="middle" data-sortable="true">Render time diff, %</th>
                <th data-filed="render_log" data-halign="center" data-valign="middle">Render log</th>
            </tr>
        </thead>
        <tbody>
        {% for test_package, value in report[i].results | dictsort %}
            {% for test_conf, value in report[i].results[test_package] | dictsort%}
                {% if report[i].results[test_package][test_conf].render_results | length > 0 %}

                {% for item in report[i].results[test_package][test_conf].render_results %}
            <tr>
                <td>{{ item.test_case }}</td>
                <td>
                    <button class="commonButton" type="button" name="copyDirectLinkButton">{{ item.test_case }}</button>
                </td>
                <td>
                    {% for param in item.script_info %}
                        {{ param }}<br/>
                    {% endfor %}
                </td>

                <td class="hatching">
                {% if item.original_color_path %}
                    {% if 'thumb64_original_color_path' in item %}
                    <img data-src="{{ item.thumb64_original_color_path }}"/>
                    {% else %}
                    <img data-src="{{ item.original_color_path }}"/>
                    {% endif %}
                {% else %}
                    Not compared
                {% endif %}
                </td>
                <td class="hatching">
                {% if item.baseline_color_path %}
                    {% if 'thumb64_baseline_color_path' in item %}
                    <img data-src="{{ item.thumb64_baseline_color_path }}"/>
                    {% else %}
                    <img data-src="{{ item.baseline_color_path }}"/>
                    {% endif %}
                {% else %}
                    Not compared
                {% endif %}
                </td>
                <td class="hatching">
                    {% if 'thumb64_render_color_path' in item %}
                    <img data-src="{{ item.thumb64_render_color_path }}"/>
                    {% else %}
                    <img data-src="{{ item.render_color_path }}"/>
                    {% endif %}
                </td>

                <td class="{{ item.test_status }}Status">{{ item.test_status | title }}</td>
                <td class="{{ item.test_status }}Status">{{ item.difference_color_2 }}</td>

                <td>{{ item.or_render_time }}</td>
                <td>{{ item.baseline_render_time }}</td>
                <td>{{ item.render_time }}</td>
                <!--TODO: 5% to conf CONSTS-->
                <td {%- if 5 < item.difference_time %}
                        class="timeWorseStatus"
                    {% elif item.difference_time < -5 %}
                        class="timeBetterStatus"
                    {% endif -%}
                    >
                    {{ item.difference_time | round(2) }}
                </td>

                <td>
                    {%- if 'render_log' in item %}
                    <a href="{{ item.render_log }}">RPR log</a>
                    {% else %}
                    <a href="{{ report[i].results[test_package][test_conf].result_path }}/renderTool.log">RPR Log</a>
                    {% endif -%}

                    {%- if "true" in or_boolean_formatted %}
                    <a href="{{ report[i].results[test_package][test_conf].result_path }}/{{ item.original_render_log }}">{{ original_render | title }} log</a><br/>
                    <a href="{{ report[i].results[test_package][test_conf].result_path }}/{{ item.scene_name }}.conversion.log">Conversion log</a><br/>
                    {% endif -%}
                </td>
            </tr>
                {% endfor %}
                {% endif %}
            {% endfor %}
        {% endfor %}
        </tbody>
    </table>
</div>

{% endblock %}