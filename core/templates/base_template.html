<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <link rel="stylesheet" type="text/css" href="{{ pre_path }}/report_resources/css/bootstrap.css"/>
    <link rel="stylesheet" type="text/css" href="{{ pre_path }}/report_resources/css/bootstrap-table.css"/>
    <link rel="stylesheet" type="text/css" href="{{ pre_path }}/report_resources/css/style.css"/>
    <link rel="stylesheet" type="text/css" href="{{ pre_path }}/report_resources/css/test-statuses.css"/>

    <script src="{{ pre_path }}/report_resources/js/thirdparty/jquery-3.3.1.min.js" type="text/javascript"></script>

    <script src="{{ pre_path }}/report_resources/js/thirdparty/bootstrap.js" type="text/javascript"></script>
    <script src="{{ pre_path }}/report_resources/js/thirdparty/bootstrap-table.js" type="text/javascript"></script>
    <script src="{{ pre_path }}/report_resources/js/extensions/multiple-sort/bootstrap-table-multiple-sort.js"></script>
    <script src="{{ pre_path }}/report_resources/js/extensions/toolbar/bootstrap-table-toolbar.js"></script>

    <script src="{{ pre_path }}/report_resources/js/scripts.js" type="text/javascript"></script>

    <script src="{{ pre_path }}/report_resources/js/thirdparty/pixelmatch.js"></script>
    <script src="{{ pre_path }}/report_resources/js/thirdparty/opencv.js"></script>
    <script src="{{ pre_path }}/report_resources/js/images-substr.js"></script>
    <script src="{{ pre_path }}/report_resources/js/bootstrap-table-custom.js"></script>

    <script type="text/javascript">
        $(document).ready(function init(){
        {% if pageID is defined %}
            setActive({{ pageID }});
        {% endif %}
        });
    </script>

    {% if performance_report is defined %}
    <script src="https://cdn.jsdelivr.net/npm/chart.js@2.8.0"></script>
    <script type="text/javascript">
      var toolColors = ['#aa2a', '#a2aa', '#2aaa', '#a22a', '#2a2a', '#22aa', '#ff2a', '#f2fa', '#2ffa', '#f22a', '#2f2a', '#22fa']

      renderDataSet = [
        {% for hw in hardware %}
          {
            label: '{{ hw[0] | replace('Darwin', '') | replace('Windows', '') }}',
            backgroundColor: toolColors[{{ loop.index }} % toolColors.length],
            data: [
              {% for tool in test_info %}
                {% if test_info[tool][hw[0]].sync > 0 %}
                  '{{test_info[tool][hw[0]].sync}}'
                {% endif %}
              {% endfor %}
            ]
          }{{ "," if not loop.last }}
        {% endfor %}
      ]

      syncDataSet = [
        {% for hw in hardware %}
          {
            label: '{{ hw[0] | replace('Darwin', '') | replace('Windows', '') }}',
            backgroundColor: toolColors[{{ loop.index }} % toolColors.length],
            data: [
              {% for tool in test_info %}
                {% if test_info[tool][hw[0]].sync > 0 %}
                  '{{test_info[tool][hw[0]].sync}}'
                {% endif %}
              {% endfor %}
            ]
          }{{ "," if not loop.last }}
        {% endfor %}
      ]

      var renderData = {
        labels: [' '],

        datasets: renderDataSet
      }

      renderToolDataSet = [
        {% for tool in test_info %}
          {
            label: '{{ tool }}',
            backgroundColor: toolColors[{{ loop.index }} % toolColors.length],
            data: [
              {% for hw in hardware %}
                '{{ test_info[tool][hw[0]].render | round(3) }}'{{ "," if not loop.last }}
              {% endfor %}
            ]
          }{{ "," if not loop.last }}
        {% endfor %}
      ]

      syncToolDataSet = [
        {% for tool in test_info %}
          {
            label: '{{ tool }}',
            backgroundColor: toolColors[{{ loop.index }} % toolColors.length],
            data: [
              {% for hw in hardware %}
                '{{ test_info[tool][hw[0]].sync | round(3) }}'{{ "," if not loop.last }}
              {% endfor %}
            ]
          }{{ "," if not loop.last }}
        {% endfor %}
      ]

      var renderToolData = {
        labels: [
            {% for hw in hardware %}
              '{{ hw[0] | replace('Darwin', '') | replace('Windows', '') }}'{{ "," if not loop.last }}
            {% endfor %}
          ],

        datasets: renderToolDataSet
      }

      renderOptions = {
        maintainAspectRatio: false,
        legend: {position: 'right'},
        title: {
          display: true,
          text: 'Total render time'
        },
        scales: {yAxes: [{ticks: {beginAtZero: true}}]}
      }

      renderToolOptions = {
        maintainAspectRatio: false,
        legend: {position: 'right'},
        title: {
          display: true,
          text: 'Total render time'
        },
        scales: {
          xAxes: [{stacked: true}],
          yAxes: [{stacked: true}]
        }
      }

      function createChart(elementID, dataSet, toolOptions) {
        var ctxRender = document.getElementById(elementID).getContext('2d');
        var chartRender = new Chart(ctxRender, {
            type: 'bar',
            data: dataSet,
            options: toolOptions
        });
      }

      window.onload = function () {
        createChart('chartRender', renderData, renderOptions);

        $('#checkboxChartRender').change(function(){
          if($(this).is(':checked')) {
            createChart('chartRender', renderToolData, renderToolOptions);
          } else {
            createChart('chartRender', renderData, renderOptions);
          }
        })

        {% if synchronization_time %}
          syncData = {}
          Object.assign(syncData, renderData);
          syncData["datasets"] = syncDataSet;

          syncOptions = {};
          Object.assign(syncOptions, renderOptions)
          syncOptions["title"]["text"] = "Total synchronization time";

          syncToolData = {}
          Object.assign(syncToolData, renderToolData);
          syncToolData["datasets"] = syncToolDataSet;

          syncToolOptions = {};
          Object.assign(syncToolOptions, renderToolOptions)
          syncOptions["title"]["text"] = "Total synchronization time";

          createChart('chartSync', syncData, syncOptions);

          $('#checkboxChartSync').change(function(){
            if($(this).is(':checked')) {
              createChart('chartSync', syncToolData, syncToolOptions);
            } else {
              createChart('chartSync', syncData, syncOptions);
            }
          })
        {% endif %}
      }
    </script>
    {% endif %}

    <title>{{ title }}</title>
</head>

<body>
    <a name="#top"/>
    <a id="goTop" href="#top" title="Go top"><span class="glyphicon glyphicon-arrow-up" aria-hidden="true" aria-label="Go top"></span></a>

    <div id="infoBox"></div>

    <div id="header">
        <img src="{{ pre_path}}/report_resources/img/logo.png"/>

        <ul>
            <li><a id="summaryA" href='{{ pre_path }}/summary_report.html'>summary</a></li>
            <li><a id="performanceA" href='{{ pre_path }}/performance_report.html'>performance</a></li>
            <li><a id="compareA" href='{{ pre_path }}/compare_report.html'>compare</a></li>
        </ul>
    </div>

    {% include "base_table_block.html" %}

    <hr>

    {% block report_body %}
    {% endblock %}

    <hr>

    <div id="footer">
        Luxoft RPR CIS
        <br>
        2017-2020
        <br>
        jobs_launcher v{{ "v" | get_jobs_launcher_version() }}
    </div>

</body>
</html>