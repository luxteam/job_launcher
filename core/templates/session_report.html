<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <style media="screen" type="text/css">
        tr, th, td {
            width: auto;
            padding: 5px;
            border: 1px solid black;
        }
        table{
            border-collapse: collapse;

        }

        .heap {
            font-family: Arial;
            width: auto;
        }
        .heap td {
            text-align: center;
            font-family: Arial;
            font-size: 16px;
            padding: 4px 7px 2px;
            vertical-align: top;
        }
        .heap th {
            text-shadow: rgba(255, 255, 255, 0.796875) 0px 1px 0px;
            font-family: Arial,"Bitstream Vera Sans",Helvetica,Verdana,sans-serif;
            font-weight: 700;
            line-height: 1.3em;
            font-size: 16px;
            background-color: "#d0e0e0"
        }

        .logTable td{
            text-align: left;
        }

        .detailsTable img{
            width: 64px;
            height: 64px;
            text-align: center;
            font-weight: 600;
        }

        .overlay {
            top: 0;
            right: 0;
            bottom: 0;
            left: 0;
            z-index: 10;
            display: none;

            background-color: rgba(0, 0, 0, 0.2);
            position: fixed;
            cursor: default;
        }
        .overlay:target {
            display: block;
        }

        .popup {
            top: -100%;
            /*right: 0;*/
            left: 70%;
            font-size: 14px;
            z-index: 20;
            margin: 0;
            /*width: 85%;*/
            min-width: 320px;
            max-width: 600px;

            position: fixed;
            padding: 15px;
            border: 1px solid #383838;
            background: #fefefe;

            border-radius: 4px;
            font: 14px/18px 'Tahoma', Arial, sans-serif;
        }

        .overlay:target+.popup {
            -webkit-transform: translate(-50%, 0);
            -ms-transform: translate(-50%, 0);
            -o-transform: translate(-50%, 0);
            transform: translate(-50%, 0);
            top: 20%;
        }

        .close {
            top: -10px;
            right: -10px;
            width: 20px;
            height: 20px;
            position: absolute;
            padding: 0;
            border: 2px solid #ccc;

            border-radius: 15px;
            background-color: rgba(61, 61, 61, 0.8);

            text-align: center;
            text-decoration: none;
            font: 13px/20px 'Tahoma', Arial, sans-serif;
            font-weight: bold;
        }
        .close:before {
            color: rgba(255, 255, 255, 0.9);
            content: "X";
            text-shadow: 0 -1px rgba(0, 0, 0, 0.9);
            font-size: 12px;
        }
        .close:hover {
            background-color: rgba(252, 20, 0, 0.8);
        }

        #goTop a{
            position: fixed;
            bottom: 0;
            margin: 1px;
            padding: 6px;
            display: block;
            background-color: #969696;
            text-align: center;
            font-size: 20px;
            color: #000;
            text-decoration: none;
            border: 1px solid black;
            z-index: 2;
        }

        .hatching {
            background:
                    linear-gradient(45deg, rgba(0, 0, 0, 0) 49.9%, black 49.9%, black 60%, rgba(0, 0, 0, 0) 60%)
                    fixed,
                    linear-gradient(45deg, black 10%, rgba(0, 0, 0, 0) 10%)
                    fixed;
            background-size: 0.3em 0.3em;
        }
        .hatching img{
            display: block;
            margin: auto;
        }

        #footer{
            text-align: center;
            width: 100%;
            position: relative;
            float: left;
            padding: 3px;
        }

        .totalTR{
            background-color: #d1d1d1;
        }

        .machineTR td{
            border: hidden;
        }

        .testTR td{
            font-size: 20px;
            font-weight: 900;
            border-left: hidden;
            border-right: hidden;
        }

        .badResultTR td{
            background-color: #ff9d8c;
        }

        .no3borderTR td{
            border-top: hidden;
            border-left: hidden;
            border-right: hidden;
            text-align: left;
        }

    </style>
    <title>{{ title }}</title>
</head>

<body>
<div id="goTop"><a href="#tests">Go Top</a></div>

<h2>Summary</h2>

<table class="heap">
    <tr>
        <!--<th>GUID</th>-->
        <th>Job-Name</th>
        <th>Host</th>
        <th>Total</th>
        <th>Passed</th>
        <th>Failed</th>
        <th>Skipped</th>
        <th>Time taken, s</th>
        <th>Render time, s</th>
    </tr>
{% for i in report %}
    <tr>
        <!--<td>{{ report[i].guid }}</td>-->
        <td>{% if i != "_cur_" %}
                {{ i }}
            {% endif %}
        </td>
        <td>
            <a href="#machineInfo{{ loop.index }}">{{ report[i].machine_info.host }}</a>
            <a href="#x" class="overlay" id="machineInfo{{ loop.index }}"></a>
            <div class="popup">
                <a class="close" title="Close" href="#close"></a>
                <table class="logTable">
                    <tr>
                        <th>OS</th>
                        <th>RAM, Gb</th>
                        <th>CPU</th>
                        <th>CPU count</th>
                        <th>GPU</th>
                        <th>Plugin</th>
                        <th>Core</th>
                    </tr>
                    <tr>
                        <td>{{ report[i].machine_info.os }}</td>
                        <td>{{ report[i].machine_info.ram | round }}</td>
                        <td>{{ report[i].machine_info.cpu }}</td>
                        <td>{{ report[i].machine_info.cpu_count }}</td>
                        {% set test_name = report[i].results | first %}
                        {% set test_conf = report[i].results[test_name] | first %}
                        <td>{# report[i].results[test_name][test_conf].render_results[0].render_device #}
                            {{ report[i].machine_info.render_device }}</td>
                        <td>{# report[i].results[test_name][test_conf].render_results[0].render_version #}
                            {{ report[i].machine_info.render_version }}</td>
                        <td>{{ report[i].machine_info.core_version }}</td>
                    </tr>
                </table>
            </div>
        </td>
        <td>{{ report[i].summary.total }}</td>
        <td>{{ report[i].summary.passed }}</td>
        <td>{{ report[i].summary.failed }}</td>
        <td>{{ report[i].summary.skipped }}</td>
        <td>{{ report[i].summary.duration }}</td>
        <td>{{ report[i].summary.render_duration | round(1) }}</td>
    </tr>
{% endfor %}
    <!--<tr class="totalTR">-->
        <!--<td></td>-->
        <!--<td></td>-->
        <!--<td></td>-->
        <!--<td></td>-->
        <!--<td></td>-->
        <!--<td></td>-->
        <!--<td></td>-->
        <!--<td></td>-->
        <!--<td></td>-->
        <!--<td></td>-->
        <!--<td></td>-->
        <!--<td></td>-->
    <!--</tr>-->
</table>
<hr>


<h2>Tests</h2>
<a name="tests"></a>
<table class="heap">

{% for i in report %}
    {% set toploop = loop %}
    {% if i != "_cur_" %}
        <tr class="no3borderTR">
            <td colspan="10">
                <h3>{{ i }}</h3>
            </td>
        </tr>
    {% endif %}

        <tr>
            <th>Name</th>
            <th>Config</th>
            <th>Report</th>
            <th>Total</th>
            <th>Passed</th>
            <th>Failed</th>
            <th>Skipped</th>
            <th>Time taken, s</th>
            <th>Render time, s</th>
        </tr>

        {% for test_package in report[i].results %}
            {% set resultsloop = loop %}
        <tr>
            <td rowspan="{{ report[i].results[test_package] | length }}"><a href="#{{ i }}{{ test_package }}">{{ test_package }}</a></td>
            {% for test_conf in report[i].results[test_package] %}
                <td><a href="#{{ i }}{{ test_package }}{{ test_conf }}">{{ test_conf }}</a></td>
                <td><a href="{{ report[i].results[test_package][test_conf].result_path }}/result.html">Report</a></td>
                <td>{{ report[i].results[test_package][test_conf].total }}</td>
                <td>{{ report[i].results[test_package][test_conf].passed }}</td>
                <td>{{ report[i].results[test_package][test_conf].failed }}</td>
                <td>{{ report[i].results[test_package][test_conf].skipped }}</td>
                <td>{{ report[i].results[test_package][test_conf].duration }}</td>
                <td>{{ report[i].results[test_package][test_conf].render_duration | round(1) }}</td>
        </tr>

        <tr>
            {% endfor %}
        </tr>
        {% endfor %}

        <tr class="totalTR">
            <td colspan="3"></td>
            <td>{{ report[i].summary.total }}</td>
            <td>{{ report[i].summary.passed }}</td>
            <td>{{ report[i].summary.failed }}</td>
            <td>{{ report[i].summary.skipped }}</td>
            <td>{{ report[i].summary.duration }}</td>
            <td>{{ report[i].summary.render_duration | round(1) }}</td>
        </tr>

        <tr></tr>
{% endfor %}
</table>
<hr>

<h2>Details</h2>

<table class="detailsTable">
{% for i in report %}
    {% set toploop = loop %}
    {% if i != "_cur_" %}
        <tr class="machineTR">
            <td colspan="10"><h2>{{ i }}</h2></td>
        </tr>
    {% endif %}

    {% for test_package in report[i].results %}
        {% for test_conf in report[i].results[test_package] %}

        <tr class="testTR">
            <td colspan="10">
                Test: <a name="{{ i }}{{ test_package }}{{ test_conf }}">{{ test_package }} {{ test_conf }}</a>
            </td>
        </tr>

        {% if report[i].results[test_package][test_conf].render_results | length > 0 %}
            <tr>
                <th>Scene name</th>
                <th>File name</th>
                <th>Render time, s</th>
                <th>Pixel Difference, %</th>
                <th>Baseline Color</th>
                <th>Rendered color</th>
            </tr>
            {% for item in report[i].results[test_package][test_conf].render_results %}
                {% if not item.difference_color is string and item.difference_color > 30 %}
            <tr class="badResultTR">
                {% else %}
            <tr>
                {% endif %}

                <td>{{ item.scene_name }}</td>
                <td>{{ item.file_name }}</td>
                <td>{{ item.render_time | round(3) }}</td>
                <td>{{ item.difference_color }}</td>
                <td class="hatching">
                {% if item.baseline_color_path %}
                    <img src="{{ item.baseline_color_path }}"/>
                {% else %}
                    Not compared
                {% endif %}
                </td>
                <td class="hatching"><img src="{{ item.render_color_path }}"/></td>
            </tr>
            {% endfor %}
        {% endif %}

        {% endfor %}
    <tr></tr>
    {% endfor %}
{% endfor %}
</table>

<div id="footer">
    Luxoft RPR CIS
    <br>
    2017-2018
</div>

</body>
</html>